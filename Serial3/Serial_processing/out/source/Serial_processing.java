/* autogenerated by Processing revision 1292 on 2023-05-24 */
import processing.core.*;
import processing.data.*;
import processing.event.*;
import processing.opengl.*;

import processing.serial.*;

import java.util.HashMap;
import java.util.ArrayList;
import java.io.File;
import java.io.BufferedReader;
import java.io.PrintWriter;
import java.io.InputStream;
import java.io.OutputStream;
import java.io.IOException;

public class Serial_processing extends PApplet {



Serial arduino;
final String portName = "COM5";
final int lf = 10;
final int hedder = PApplet.parseInt('H');

final int black = 0;
final int white = 255;
final int coefficient  = 100;

final int recvSensorNum = 6;
final int recvDataSize = recvSensorNum * 2;

PFont  font;
Button button;

int tmp = 0;

class Button
{
    
    float x, y;
    float sizeX;
    float sizeY;

    protected int baseColor;

    private float normalBrightness;
    private float selsectBrightness;
    private float pushedBrightness;

    private String str[];
    private int state;

    Button(float x, float y, float sizeX, float sizeY, int baseColor)
    {
        this.x = x;
        this.y = y;
        this.sizeX = sizeX;
        this.sizeY = sizeY;
        
        this.baseColor = baseColor;
        this.state = 0;

        this.str = new String[3];
        this.str[0] = "OFF";
        this.str[1] = "OFF";
        this.str[2] = "ON";
        
        normalBrightness = 0.7f;
        selsectBrightness = 0.78f;
        pushedBrightness = 1.0f;
    }
    
    public void update()
    {
        this.updateState();
        this.draw();
    }

    protected void draw() 
    {
        rectMode(CENTER);
        colorMode(HSB, 360, 100, 100);
        textAlign(CENTER, CENTER);

        noStroke();
        changeColor();

        rect(x, y, sizeX, sizeY, 20);

        fill(0, 0, 100);
        textSize(30);
        text(str[state], x, y-5);
    }

    public boolean isPush()
    {
        if(state == 2)
        {
            return true;
        }
        return false;
    }

    protected boolean isInside()
    {
        if (mouseX > x-sizeX/2 && mouseX < x+sizeX/2) 
        {
            if (mouseY>y-sizeY/2 && mouseY<y+sizeY/2) 
            {
                return true;
            }
        }
        return false;
    }

    protected void updateState()
    {
        state = checkState();
    }

    private int checkState()
    {
        if(!isInside())
        {
            return 0;
        }
        if(!mousePressed)
        {
            return 1;
        }
        return 2;
    }

    protected void changeColor()
    {
        switch (state) 
        {
            case 0:
                fill(hue(baseColor), saturation(baseColor), brightness(baseColor)*normalBrightness);
                break;

            case 1:
                fill(hue(baseColor), saturation(baseColor), brightness(baseColor)*selsectBrightness);
                break;

            case 2:
                fill(hue(baseColor), saturation(baseColor), brightness(baseColor)*pushedBrightness);
                break;

            default:
                fill(0, 0, 0);
                break;
        }
    }
}

public void setup()
{
    surface.setResizable(true); 
    surface.setSize(640, 360);
    frameRate(60);
    /* smooth commented out by preprocessor */;

    rectMode(CENTER);
    colorMode(HSB, 360, 100, 100);
    textAlign(CENTER, CENTER);

    println(Serial.list());
    arduino = new Serial(this, portName, 115200);

    button = new Button(width/2, height/2, 200, 100, color(25, 95, 100));
}

public void draw()
{
    background(white);
    button.update();
    
    if(button.isPush())
    {
        arduino.write('H');
    }
    else 
    {
        arduino.write('L');
    }
}

public void stop()
{
    arduino.stop();
    super.stop();
}


  public void settings() { smooth(); }

  static public void main(String[] passedArgs) {
    String[] appletArgs = new String[] { "Serial_processing" };
    if (passedArgs != null) {
      PApplet.main(concat(appletArgs, passedArgs));
    } else {
      PApplet.main(appletArgs);
    }
  }
}
