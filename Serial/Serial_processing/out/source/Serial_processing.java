/* autogenerated by Processing revision 1292 on 2023-05-23 */
import processing.core.*;
import processing.data.*;
import processing.event.*;
import processing.opengl.*;

import processing.serial.*;

import java.util.HashMap;
import java.util.ArrayList;
import java.io.File;
import java.io.BufferedReader;
import java.io.PrintWriter;
import java.io.InputStream;
import java.io.OutputStream;
import java.io.IOException;

public class Serial_processing extends PApplet {



Serial arduino;
final String portName = "COM5";
final int lf = 10;

float recvData = 0;
String tmp = null;

PFont  font;

final int black = 0;
final int white = 255;
final int coefficient  = 100;

final int bufferSize = 1024;
float buffer[];

public void setup()
{
    surface.setResizable(true); 
    surface.setSize(640, 360);
    frameRate(60);
    /* smooth commented out by preprocessor */;

    font = createFont("Meiryo UI", 250);; 
    textFont(font, 18); 

    buffer = new float[bufferSize];

    for(int i = 0; i < bufferSize; i ++)
    {
        buffer[i] = 0;
    }

    println(Serial.list());
    arduino = new Serial(this, portName, 115200);
    arduino.bufferUntil(lf); 
}

public void draw()
{
    background(black);
    text("received: " + nf(recvData, 4, 2), 10, 50);

    stroke(white);
    
    float diameter = abs(recvData*coefficient);

    ellipse(width/2, height/2, diameter, diameter);
}

public void stop()
{
    arduino.stop();
    super.stop();
}

public void serialEvent(Serial p) 
{
    recvData = PApplet.parseFloat(p.readStringUntil(lf));
} 

public void update(float data)
{
    for(int i = 0 ; i < bufferSize - 1; i ++)
    {
        buffer[i] = buffer[i + 1];
    }
    buffer[bufferSize - 1] = data;
}


  public void settings() { smooth(); }

  static public void main(String[] passedArgs) {
    String[] appletArgs = new String[] { "Serial_processing" };
    if (passedArgs != null) {
      PApplet.main(concat(appletArgs, passedArgs));
    } else {
      PApplet.main(appletArgs);
    }
  }
}
