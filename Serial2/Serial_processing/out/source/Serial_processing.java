/* autogenerated by Processing revision 1292 on 2023-05-23 */
import processing.core.*;
import processing.data.*;
import processing.event.*;
import processing.opengl.*;

import processing.serial.*;

import java.util.HashMap;
import java.util.ArrayList;
import java.io.File;
import java.io.BufferedReader;
import java.io.PrintWriter;
import java.io.InputStream;
import java.io.OutputStream;
import java.io.IOException;

public class Serial_processing extends PApplet {



Serial arduino;
final String portName = "COM5";
final int lf = 10;
final int hedder = PApplet.parseInt('H');

final int black = 0;
final int white = 255;
final int coefficient  = 100;

final int recvSensorNum = 6;
final int recvDataSize = recvSensorNum * 2;
int[] recvData;
byte[] recvRawData;

PFont  font;

int tmp = 0;

public void setup()
{
    surface.setResizable(true); 
    surface.setSize(640, 360);
    frameRate(60);
    /* smooth commented out by preprocessor */;

    font = createFont("Meiryo UI", 250);; 
    textFont(font, 18); 

    println(Serial.list());
    arduino = new Serial(this, portName, 115200);

    recvData = new int[recvSensorNum];
    recvRawData = new byte[recvDataSize];
}

public void draw()
{
    background(black);
    if(arduino.available() > recvDataSize)
    {
        tmp = arduino.read();
        if(tmp == hedder)
        {
            recvRawData = arduino.readBytes(recvDataSize);
        }
        arduino.clear();
    }
    recvData = decode(recvRawData, recvDataSize);

    for(int i = 0; i < recvSensorNum; i++)
    {
        text("Sensor "+ str(i) + " :" + str(recvData[i]), 10, 50*(i+1));
    }
}

public void stop()
{
    arduino.stop();
    super.stop();
}

public int[] decode(byte data[], int len)
{
    int[] value =  new int[PApplet.parseInt(len/2)];
    for(int i = 0; i < recvSensorNum; i ++)
    {
        value[i] = (PApplet.parseInt(data[2*i+1]) << 8) + Byte.toUnsignedInt((byte)data[2*i]);
    }
    return value;
}


  public void settings() { smooth(); }

  static public void main(String[] passedArgs) {
    String[] appletArgs = new String[] { "Serial_processing" };
    if (passedArgs != null) {
      PApplet.main(concat(appletArgs, passedArgs));
    } else {
      PApplet.main(appletArgs);
    }
  }
}
